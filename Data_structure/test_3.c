#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define MAX_NUM 100

typedef struct sinfo sinfo;  // ?????¢´?¢¬¢¬? ??????¢¥? ?¢¬????
struct sinfo
{
    char name[10];        // 4??
    char gender[8];
    char city[10];        // 4??
    char dept[20];        // 8??
    char gpa[10];
    char height[10];
    char weight[10];
};

// ¢¬??? ?¢¬???? ?¢¬?? set ???©¢ ?????? ?¢¬???? ?¢´?¢¬ ¢¥? ©©???¡Æ???. 
typedef struct sset sset;
struct sset
{
    sinfo svalues[100];
    int count;
};

typedef struct smap smap;
struct smap
{
    char keys[MAX_NUM][MAX_NUM]; // Q3???¡©¢¥? dept Q4???¡©¢¥? city
    int values[MAX_NUM]; // Q3???¡©¢¥? dept¢¬?¢¥??? ???? ??
    int count;
};

typedef struct smap_Q5 smap_Q5;
struct smap_Q5
{
    char keys[MAX_NUM][MAX_NUM];
    sinfo svalues[MAX_NUM]; 
    int count;
};

// ?¡¿¢¬?¡Æ? 3,4?? ?¢¨???? ?¢¬???? ?¢¬?? map???©¢. ??¡Æ?¢§?¢¥? ?¡Æ : ¡Æ? ?¢¬??¢§? ???? 

// ??¢¬? ?¡Æ??¢¥? ??¡Æ? ¡Æ???¢¥? ???? ??¢¥? ??¡Æ??? ???? ?? ??¢§¢¬¡Æ? ©©??????

void set_print(struct sset *mySet) {
    for (int i = 0; i < mySet -> count; i++) {
        printf("%s ", mySet -> svalues[i].name);
        printf("%s ", mySet -> svalues[i].gender);
        printf("%s ", mySet -> svalues[i].city);  
        printf("%s ", mySet -> svalues[i].dept);  
        printf("%s ", mySet -> svalues[i].gpa);  
        printf("%s ", mySet -> svalues[i].height);  
        printf("%s\n", mySet -> svalues[i].weight);
    }
}

void Q1(sset sset)
{
    for(int i = 0; i < sset.count; i++)
    {
        if(strcmp(sset.svalues[i].name, "??????") == 0) // ?? ???©©¡Æ? ??¢¥?¢§? ????¢¥?¡Æ????
        {
            printf("??????¡Æ? ??¢¥? ¡Æ¡À?? %s??¢¥?¢¥?. \n", sset.svalues[i].city);
        }
    }
}

void Q2(sset sset)
{
    sinfo chun;
    for(int i = 0; i < sset.count; i++)
    {
        if(strcmp(sset.svalues[i].name, "??????") == 0)
        {
            chun = sset.svalues[i];
        }
    }

    int count_Q2 = 0;
    for(int i = 0; i < sset.count; i++)
    {
        if((atof(sset.svalues[i].gpa)) > atof(chun.gpa)) // ?¡× for?????¡© ??¢¥?¢§? ???? ¢¬???. 
        {
            count_Q2++;
        }
    }
    printf("???????¢¬¢¥? ?????? ©©??????¡À ?? : %d \n", count_Q2);
}

void Q3(sset sset)
{
    int max = 0; // Q3???¡© ?? ??¢¥?¡Æ? ???©¢ ?¡¿ ?????¡©
    smap smap; // Q3???¡© ?? ¢¬? ???©¢

    // smap ?????¡©
    smap.count = 0;

    // while ??¡Æ???????
    int process = 0;
    
    // set?? ???????? ???¡À???¢¬¢§? ??¢¥? while loop 
    while (process < sset.count )
    {
            // smap?? ????¢¬? ?????? for loop
        for (int i = 0; i <= smap.count; i++) 
        {            
            // process index?? dept¡Æ? map?? ¢¬©¢?? ?¡Æ?? ???©©???? ???? ?¡×. >> map ?¡Æ?? ?©¬¡Æ????©¬ ??
            if ( strcmp(smap.keys[i], sset.svalues[process].dept) == 0 ) // ??¡Æ? ?? ??¡Æ?¢¬???? ??????
            {
                (smap.values[i])++;
                break;
            }
            // process index?? dept¡Æ? map?? ?? ?¡Æ?? ??¡Æ¡Æ?? ?¡× >> map ??¢¥???¢¥? ?¡Æ?? ¡Æ??? ++???©¬??
            else if ( i == smap.count ) // It contains strcmp(smap.keys[i-1], sset.svalues[process].dept) != 0 because of else
            {
                strcpy(smap.keys[smap.count], sset.svalues[process].dept);  // ?¡Æ ?©¬¡Æ?
                (smap.values[smap.count]) = 1;                                // ??¢§??? ?¡Æ?? ¡Æ? ++
                smap.count++;  // ?¡Æ ?©¬¡Æ????¢©?? count¢§? ??
                break;
            }
            // ?¡× ??¡Æ??? ¡Æ???¡Æ? ??¢¥? = ¡Æ???¢¥? ?¡Æ?? ????¢¬¢¬, ???¡À map?? ?¡Æ¢¬? ¢¥? ????????¢¥? ¢¬? ??.
        }
        process++; // while loop¢¬? ????¢§???¢¥? process¢¬? 1 ??¡Æ?¢©??¢¥. (loop 1?¢¬)
    }
    
    for (int i = 0; i < smap.count; i++)
    {
        if (smap.values[max] < smap.values[i])
        {
            max = smap.values[i+1];
        }
        
    }

    printf("???? ??¡Æ? ¡Æ??? ¢¬??? ??¡Æ??? ???? ?? : %s \n", smap.keys[max]);
    
}

void Q4(sset sset)
{
    int max = 0; // Q3???¡© ?? ??¢¥?¡Æ? ???©¢ ?¡¿ ?????¡©
    smap smap; // Q3???¡© ?? ¢¬? ???©¢

    // smap ?????¡©
    smap.count = 0;

    // while ??¡Æ???????
    int process = 0;
    
    // set?? ???????? ???¡À???¢¬¢§? ??¢¥? while loop 
    while (process < sset.count )
    {
            // smap?? ????¢¬? ?????? for loop
        for (int i = 0; i <= smap.count; i++) 
        {            
            // process index?? dept¡Æ? map?? ¢¬©¢?? ?¡Æ?? ???©©???? ???? ?¡×. >> map ?¡Æ?? ?©¬¡Æ????©¬ ??
            if ( strcmp(smap.keys[i], sset.svalues[process].city) == 0 ) // ??¡Æ? ?? ??¡Æ?¢¬???? ??????
            {
                (smap.values[i])++;
                break;
            }
            // process index?? dept¡Æ? map?? ?? ?¡Æ?? ??¡Æ¡Æ?? ?¡× >> map ??¢¥???¢¥? ?¡Æ?? ¡Æ??? ++???©¬??
            else if ( i == smap.count )
            {
                strcpy(smap.keys[smap.count], sset.svalues[process].city);  // ?¡Æ ?©¬¡Æ?
                (smap.values[smap.count]) = 1;                                // ??¢§??? ?¡Æ?? ¡Æ? ++
                smap.count++;  // ?¡Æ ?©¬¡Æ????¢©?? count¢§? ??
                break;
            }
            // ?¡× ??¡Æ??? ¡Æ???¡Æ? ??¢¥? = ¡Æ???¢¥? ?¡Æ?? ????¢¬¢¬, ???¡À map?? ?¡Æ¢¬? ¢¥? ????????¢¥? ¢¬? ??.
        }
        process++; // while loop¢¬? ????¢§???¢¥? process¢¬? 1 ??¡Æ?¢©??¢¥. (loop 1?¢¬)
    }
    
    // TODO: Print in order of many city.
}
void Q5(sset sset, smap_Q5 smap_Q5, char* name)
{
    int search_index = 0;
    int check_same = 0;
    for(int i = 0; i < sset.count; i++)
    {
        smap_Q5.svalues[i] = sset.svalues[i];
        smap_Q5.count++;
        strcpy(smap_Q5.keys[i], sset.svalues[i].name);
    }

    for (int j = 0; j < smap_Q5.count; j++)
    {
        if(strcmp(name, smap_Q5.keys[j]) == 0)
        {
            search_index = j;
            check_same++;
        }
    }
    if(check_same == 1)
    {
        printf("%s, %s, %s, %s, %s, %s, %s \n", smap_Q5.svalues[search_index].name,
            smap_Q5.svalues[search_index].gender, smap_Q5.svalues[search_index].city,
            smap_Q5.svalues[search_index].dept, smap_Q5.svalues[search_index].gpa,
            smap_Q5.svalues[search_index].height, smap_Q5.svalues[search_index].weight);
    }
    else if (check_same == 2)
    {
        printf("?? ?¡Æ¢¥? ?©¬????¢¥?¢¥?.");
    }

    else
    {
        printf("??¢§???¢©? ?¡Æ¢¥? map?? ??¢©?¢¥?¢¥?.");
    }
    
}

int main() 
{
    FILE *fp;
    char line[256];  // ??¢¥? ?????¡© ????
    int num_records = 0;
    sset my_sset;       // ???? ???©¢
    sinfo temp;
    int check_same = 0;
    smap_Q5 smap_Q5;

    // Open file for reading
    fp = fopen("list.txt", "r+t");
    if (fp == NULL) 
    {
        printf("?????? ?¡© ?? ??¢©?¢¥?¢¥?. \n");
        return 0;
    }

    // ???? ????
    while (fgets(line, sizeof(line), fp))
    {
        check_same = 0; 
        sscanf(line, "%s%s%s%s%s%s%s", temp.name, temp.gender, temp.city, temp.dept, temp.gpa, temp.height, temp.weight);
        if (my_sset.count == 0)
        {
            my_sset.svalues[0] = temp; // ?©¬¡Æ??? ?¡×???? ?©¬¡Æ?
            my_sset.count++; 
            continue;
        }
        for(int j = 0; j <= my_sset.count; j++)
        {
            if(strcmp(temp.name, my_sset.svalues[j].name) == 0)
            {
                check_same = 1;
            }
        }
        if (check_same == 0) // ?©¬?? ??¢¥? ¡Æ??? -- ??¢§? ?©¬¡Æ?(?©¢??)
        {
            int index = 0;   // while???¡© ?? ¢§???????????, ?©¬¡Æ??? ?¡×??¢¬? ¡Æ?¢¬??¢¥
            while(index <= my_sset.count) 
            {
                if (index == my_sset.count-1)
                {
                    if ((index + 1) < MAX_NUM )
                    {
                        my_sset.svalues[index+1] = temp;
                    }

                    else
                    {
                        printf("?¢´?¢¬¢¬? ¢¥? ???? ?©¬¡Æ??? ?? ??¢©?¢¥?¢¥?.");
                    }
                    
                }
                
                if(strcmp(my_sset.svalues[index].name,temp.name) >= 0 ) // 0??¢´? index?? ?©¬¡Æ??? ?¡×
                {
                    for(int index2 = my_sset.count; index2 >= index; index2-- )  //  ¢¬? ©©??? ?©¬¡Æ????¡×¢¬? ??¡Æ¢¨???¡© ???? ¢¬?¡Æ? ????¢¬? ¡Æ??¡×
                        my_sset.svalues[index2 + 1] = my_sset.svalues[index2];   // ??¢§? ????
                    my_sset.svalues[index] = temp; // ?©¬¡Æ??? ?¡×???? ?©¬¡Æ? 
                    my_sset.count++; // ??¡Æ? ??????
                    break;
                }
                index++; // ??¡Æ? ??????
            }
        }
    }
    
    // q1. ??????¡Æ? ??¢¥?¡Æ¡À

    set_print(&my_sset);
    Q1(my_sset);
    printf("============== process Q1 is good ===============\n");

    // q2. ???????¢¬¢¥? ?????? ©©??????¡À?? ¢¬? ¢¬?????
    
    Q2(my_sset);
    printf("============== process Q2 is good ===============\n");

    // q3. ¡Æ??? ?????? ¢¬?????¡Æ?¢¥??
    Q3(my_sset);
    printf("============== process Q3 is good ===============\n");

    // q4. ¡Æ??? ¢¬??? ?????? ¡Æ?????¢¥? ???? ???¡©¢¥?¢§? ?????? ??¢§?????.
    Q4(my_sset);
    printf("============== process Q4 is good ===============\n");
    
    // q5. ???????? ??¢¬¡×?? id¢§? ?????? ?? ??¢¥?¡Æ?? 
    // x -> ??¢¬??????? ???? ?¡×???? ???????? ??¢¬¡×?? id¢§? ?????? ??¢¥? ???¢©.
    Q5(my_sset, smap_Q5, "????");
    printf("============== process Q5 is good ===============\n");
}